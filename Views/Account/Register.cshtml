@{
    Layout = null;
    var errorMsg = ViewBag.Error as string;
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký tài khoản — SmartStay</title>
    <meta name="description" content="Tạo tài khoản người thuê SmartStay">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter','Segoe UI',sans-serif;
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            padding: 1.5rem 1rem;
            position: relative; overflow-x: hidden;
        }
        body::before, body::after {
            content:''; position:fixed; border-radius:50%;
            filter:blur(90px); opacity:.2; pointer-events:none;
        }
        body::before { width:550px;height:550px; background:radial-gradient(circle,#a29bfe,transparent); top:-140px;right:-100px; }
        body::after  { width:450px;height:450px; background:radial-gradient(circle,#00b894,transparent); bottom:-80px;left:-80px; }

        .card {
            width:100%; max-width:460px;
            background:rgba(255,255,255,.06);
            backdrop-filter:blur(24px); -webkit-backdrop-filter:blur(24px);
            border:1px solid rgba(255,255,255,.12);
            border-radius:24px; padding:2.25rem 2rem 2rem;
            box-shadow:0 24px 64px rgba(0,0,0,.4);
            animation:slideUp .45s cubic-bezier(.22,.78,.38,1) both;
            position:relative; z-index:1;
        }
        @@keyframes slideUp {
            from { opacity:0; transform:translateY(28px); }
            to   { opacity:1; transform:translateY(0); }
        }

        .logo-ring {
            width:60px; height:60px;
            background:linear-gradient(135deg,#a29bfe,#00b894);
            border-radius:18px;
            display:flex; align-items:center; justify-content:center;
            margin:0 auto 1.1rem;
            font-size:1.4rem; color:#fff;
            box-shadow:0 8px 24px rgba(162,155,254,.4);
        }
        h1 { font-size:1.35rem;font-weight:700;color:#fff;text-align:center;margin-bottom:.25rem; }
        .sub { text-align:center;color:rgba(255,255,255,.4);font-size:.8rem;margin-bottom:1.6rem; }

        /* Info banner */
        .info-banner {
            background:rgba(108,92,231,.15);
            border:1px solid rgba(108,92,231,.3);
            border-radius:10px; padding:.65rem .9rem;
            font-size:.8rem; color:rgba(255,255,255,.6);
            margin-bottom:1.2rem;
            display:flex; align-items:flex-start; gap:.5rem;
        }
        .info-banner i { color:#a29bfe; margin-top:.05rem; flex-shrink:0; }

        /* Alert */
        .alert-err {
            background:rgba(214,48,49,.18);
            border:1px solid rgba(214,48,49,.35);
            color:#ff7675; border-radius:10px;
            padding:.65rem .9rem; font-size:.82rem;
            margin-bottom:1rem;
            display:flex; align-items:center; gap:.5rem;
        }

        /* Fields */
        .row2 { display:grid; grid-template-columns:1fr 1fr; gap:.85rem; }
        .field { margin-bottom:.9rem; }
        .field label {
            display:block; font-size:.75rem; font-weight:600;
            color:rgba(255,255,255,.5); margin-bottom:.35rem;
            text-transform:uppercase; letter-spacing:.05em;
        }
        .req { color:#ff7675; }
        .input-wrap { position:relative; }
        .input-wrap i.ico {
            position:absolute; left:.9rem; top:50%; transform:translateY(-50%);
            color:rgba(255,255,255,.28); font-size:.84rem;
            pointer-events:none; transition:color .2s;
        }
        .input-wrap:focus-within i.ico { color:#a29bfe; }
        .input-wrap input {
            width:100%; padding:.75rem .9rem .75rem 2.35rem;
            background:rgba(255,255,255,.07);
            border:1.5px solid rgba(255,255,255,.1);
            border-radius:11px; color:#fff;
            font-size:.9rem; font-family:inherit; outline:none;
            transition:border-color .2s, background .2s, box-shadow .2s;
        }
        .input-wrap input:focus {
            border-color:#a29bfe; background:rgba(255,255,255,.1);
            box-shadow:0 0 0 3px rgba(108,92,231,.2);
        }
        .input-wrap input::placeholder { color:rgba(255,255,255,.18); }
        .input-wrap input.err-field { border-color:rgba(214,48,49,.55); }
        .toggle-pw {
            position:absolute; right:.75rem; top:50%; transform:translateY(-50%);
            background:none; border:none; cursor:pointer;
            color:rgba(255,255,255,.28); font-size:.84rem; padding:.2rem;
            transition:color .2s;
        }
        .toggle-pw:hover { color:rgba(255,255,255,.65); }

        /* Password strength */
        .pw-strength { margin-top:.4rem; }
        .pw-bar { height:3px; border-radius:2px; background:rgba(255,255,255,.08); overflow:hidden; }
        .pw-bar-fill { height:100%; width:0; border-radius:2px; transition:width .3s, background .3s; }
        .pw-hint { font-size:.71rem; color:rgba(255,255,255,.35); margin-top:.25rem; }

        /* Field error */
        .field-err { font-size:.72rem; color:#ff7675; margin-top:.3rem; display:none; }

        /* Submit */
        .btn-submit {
            width:100%; padding:.85rem;
            background:linear-gradient(135deg,#6c5ce7,#00b894);
            border:none; border-radius:12px; color:#fff;
            font-weight:700; font-size:.93rem; font-family:inherit;
            cursor:pointer; margin-top:.5rem;
            transition:opacity .2s, transform .15s, box-shadow .2s;
        }
        .btn-submit:hover  { opacity:.9; transform:translateY(-2px); box-shadow:0 8px 24px rgba(108,92,231,.4); }
        .btn-submit:active { transform:translateY(0); }
        .btn-submit:disabled { opacity:.5; cursor:not-allowed; transform:none; }
        @@keyframes spin { to { transform:rotate(360deg); } }
        .spinner { display:none;width:15px;height:15px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:.4rem; }
        .btn-submit.loading .spinner  { display:inline-block; }
        .btn-submit.loading .btn-text { opacity:.7; }

        .divider { display:flex;align-items:center;gap:.7rem;margin:1.2rem 0; }
        .divider::before,.divider::after { content:'';flex:1;height:1px;background:rgba(255,255,255,.1); }
        .divider span { font-size:.73rem;color:rgba(255,255,255,.28);white-space:nowrap; }

        .footer-link { text-align:center;font-size:.81rem;color:rgba(255,255,255,.4); }
        .footer-link a { color:#a29bfe;font-weight:600;text-decoration:none; }
        .footer-link a:hover { text-decoration:underline; }

        @@media (max-width:400px) { .row2 { grid-template-columns:1fr; } }
    </style>
</head>
<body>
<div class="card">
    <div class="logo-ring"><i class="fas fa-user-plus"></i></div>
    <h1>Tạo tài khoản</h1>
    <p class="sub">Đăng ký để tìm và quản lý phòng thuê của bạn</p>

    <div class="info-banner">
        <i class="fas fa-circle-info"></i>
        <span>Tài khoản đăng ký sẽ có quyền <strong style="color:#a29bfe">Người thuê</strong>.
        Quyền Nhân viên / Admin do quản trị viên cấp riêng.</span>
    </div>

    @if (!string.IsNullOrEmpty(errorMsg))
    {
        <div class="alert-err" id="errBox">
            <i class="fas fa-circle-exclamation"></i>
            <span>@errorMsg</span>
        </div>
    }

    <form method="post" asp-action="Register" asp-controller="Account" id="regForm" novalidate>
        @Html.AntiForgeryToken()

        <div class="row2">
            <div class="field">
                <label for="fullName">Họ và tên</label>
                <div class="input-wrap">
                    <i class="fas fa-id-card ico"></i>
                    <input id="fullName" name="fullName" type="text"
                           placeholder="Nguyễn Văn A"
                           autocomplete="name" maxlength="100"
                           oninput="clearErr(this)" />
                </div>
                <div class="field-err" id="err-fullName"></div>
            </div>

            <div class="field">
                <label for="phone">Số điện thoại</label>
                <div class="input-wrap">
                    <i class="fas fa-phone ico"></i>
                    <input id="phone" name="phone" type="tel"
                           placeholder="0901234567"
                           autocomplete="tel" maxlength="12"
                           pattern="[0-9]{9,12}"
                           oninput="clearErr(this)" />
                </div>
                <div class="field-err" id="err-phone"></div>
            </div>
        </div>

        <div class="field">
            <label for="username">Tên đăng nhập <span class="req">*</span></label>
            <div class="input-wrap">
                <i class="fas fa-user ico"></i>
                <input id="username" name="username" type="text"
                       placeholder="Chỉ chữ, số, gạch dưới (min 4 ký tự)"
                       autocomplete="username" required
                       minlength="4" maxlength="40"
                       pattern="[a-zA-Z0-9_]+"
                       spellcheck="false"
                       oninput="clearErr(this)" />
            </div>
            <div class="field-err" id="err-username"></div>
        </div>

        <div class="field">
            <label for="email">Email <span class="req">*</span></label>
            <div class="input-wrap">
                <i class="fas fa-envelope ico"></i>
                <input id="email" name="email" type="email"
                       placeholder="you@example.com"
                       autocomplete="email" required maxlength="150"
                       oninput="clearErr(this)" />
            </div>
            <div class="field-err" id="err-email"></div>
        </div>

        <div class="field">
            <label for="password">Mật khẩu <span class="req">*</span></label>
            <div class="input-wrap">
                <i class="fas fa-lock ico"></i>
                <input id="password" name="password" type="password"
                       placeholder="Tối thiểu 8 ký tự"
                       autocomplete="new-password" required
                       minlength="8" maxlength="128"
                       oninput="onPwChange(this.value); clearErr(this)" />
                <button type="button" class="toggle-pw" onclick="togglePw('password',this)" aria-label="Hiện/ẩn">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <div class="pw-strength">
                <div class="pw-bar"><div class="pw-bar-fill" id="pwFill"></div></div>
                <div class="pw-hint" id="pwHint"></div>
            </div>
            <div class="field-err" id="err-password"></div>
        </div>

        <div class="field">
            <label for="confirmPw">Xác nhận mật khẩu <span class="req">*</span></label>
            <div class="input-wrap">
                <i class="fas fa-shield-halved ico"></i>
                <input id="confirmPw" name="confirmPw" type="password"
                       placeholder="Nhập lại mật khẩu"
                       autocomplete="new-password" required maxlength="128"
                       oninput="clearErr(this)" />
                <button type="button" class="toggle-pw" onclick="togglePw('confirmPw',this)" aria-label="Hiện/ẩn">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <div class="field-err" id="err-confirmPw"></div>
        </div>

        <button type="submit" class="btn-submit" id="submitBtn">
            <span class="spinner"></span>
            <span class="btn-text">Tạo tài khoản</span>
        </button>
    </form>

    <div class="divider"><span>đã có tài khoản</span></div>
    <div class="footer-link">
        <a asp-action="Login" asp-controller="Account">
            <i class="fas fa-arrow-left" style="font-size:.75rem;margin-right:.3rem;"></i>Quay lại đăng nhập
        </a>
    </div>
</div>

<script>
    /* ── Password show/hide ── */
    function togglePw(id, btn) {
        const inp = document.getElementById(id);
        const ico = btn.querySelector('i');
        const hidden = inp.type === 'password';
        inp.type = hidden ? 'text' : 'password';
        ico.className = hidden ? 'fas fa-eye-slash' : 'fas fa-eye';
    }

    /* ── Strength ── */
    function onPwChange(val) {
        const fill = document.getElementById('pwFill');
        const hint = document.getElementById('pwHint');
        if (!val) { fill.style.width='0'; hint.textContent=''; return; }
        let s = 0;
        if (val.length >= 8)  s++;
        if (val.length >= 12) s++;
        if (/[A-Z]/.test(val)) s++;
        if (/[0-9]/.test(val)) s++;
        if (/[^a-zA-Z0-9]/.test(val)) s++;
        const lv = [
            { pct:'20%', c:'#d63031', t:'Rất yếu' },
            { pct:'40%', c:'#e17055', t:'Yếu' },
            { pct:'60%', c:'#fdcb6e', t:'Trung bình' },
            { pct:'80%', c:'#00b894', t:'Mạnh' },
            { pct:'100%',c:'#00cec9', t:'Rất mạnh 💪' },
        ][Math.max(0, s - 1)];
        fill.style.width = lv.pct; fill.style.background = lv.c;
        hint.textContent = lv.t; hint.style.color = lv.c;
    }

    /* ── Clear error ── */
    function clearErr(inp) {
        inp.classList.remove('err-field');
        const e = document.getElementById('err-' + inp.id);
        if (e) e.style.display = 'none';
    }

    function showErr(id, msg) {
        const inp = document.getElementById(id);
        const e   = document.getElementById('err-' + id);
        inp.classList.add('err-field');
        if (e) { e.textContent = msg; e.style.display = 'block'; }
        return false;
    }

    /* ── Validate + submit ── */
    document.getElementById('regForm').addEventListener('submit', function(ev) {
        let ok = true;
        const first = (id, msg) => { if (ok) document.getElementById(id).focus(); showErr(id, msg); ok = false; };

        const un  = document.getElementById('username').value.trim();
        const em  = document.getElementById('email').value.trim();
        const pw  = document.getElementById('password').value;
        const cpw = document.getElementById('confirmPw').value;
        const ph  = document.getElementById('phone').value.trim();

        if (!un || un.length < 4 || !/^[a-zA-Z0-9_]+$/.test(un))
            first('username', 'Tối thiểu 4 ký tự, chỉ chữ/số/gạch dưới, không dấu');

        if (!em || !/^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/.test(em))
            first('email', 'Email không hợp lệ');

        if (!pw || pw.length < 8)
            first('password', 'Tối thiểu 8 ký tự');

        if (pw && cpw !== pw)
            first('confirmPw', 'Mật khẩu xác nhận không khớp');

        if (ph && !/^[0-9]{9,12}$/.test(ph))
            first('phone', 'Số điện thoại chỉ gồm 9-12 chữ số');

        if (!ok) { ev.preventDefault(); return; }

        document.getElementById('submitBtn').classList.add('loading');
        document.getElementById('submitBtn').disabled = true;
    });

    /* ── Auto-dismiss error ── */
    const errBox = document.getElementById('errBox');
    if (errBox) {
        setTimeout(() => {
            errBox.style.transition = 'opacity .4s';
            errBox.style.opacity = '0';
            setTimeout(() => errBox.remove(), 400);
        }, 7000);
    }
</script>
</body>
</html>