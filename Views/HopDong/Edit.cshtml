@model HopDong
@* LƯU Ý: Thay YourNamespace.Models bằng namespace thực chứa Enum TrangThaiHopDong của bạn nếu cần *@

@{
    ViewData["Title"] = "Chỉnh sửa hợp đồng";
}

<style>
    /* --- THEME VARIABLES (Đồng bộ với trang Details) --- */
    :root {
        --theme-primary: var(--brand-600);
        --theme-secondary: var(--accent-500);
        --theme-gradient: var(--brand-gradient);
        --theme-surface: #ffffff;
        --theme-bg-body: #f3f4f6;
        --theme-border-focus: rgba(106, 17, 203, 0.5);
        --theme-shadow-focus: 0 0 0 0.25rem rgba(106, 17, 203, 0.15);
        --theme-input-bg: #fdfdfd;
    }

    body {
        background-color: var(--theme-bg-body);
        font-family: 'Segoe UI', sans-serif;
    }

    /* --- ANIMATION --- */
    @@keyframes slideUpFade {
        from

    {
        opacity: 0;
        transform: translateY(15px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    .animate-form {
        animation: slideUpFade 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    /* --- CARD STYLES --- */
    .card-edit-theme {
        background: var(--theme-surface);
        border: 1px solid rgba(106, 17, 203, 0.1);
        border-radius: 20px;
        box-shadow: 0 10px 30px -10px rgba(106, 17, 203, 0.1);
        overflow: hidden;
        position: relative;
    }

        .card-edit-theme::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--theme-gradient);
        }

    /* --- FORM CONTROLS --- */
    .form-label-theme {
        font-weight: 600;
        color: #4a5568;
        font-size: 0.9rem;
        margin-bottom: 0.4rem;
    }

    .input-group-text-theme {
        background-color: #f8f9fa;
        border: 1px solid #e2e8f0;
        border-right: none;
        color: var(--theme-primary);
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
        width: 45px;
        justify-content: center;
    }

    .form-control-theme, .form-select-theme {
        background-color: var(--theme-input-bg);
        border: 1px solid #e2e8f0;
        border-left: none; /* Liền mạch với icon */
        border-top-right-radius: 12px;
        border-bottom-right-radius: 12px;
        padding: 0.7rem 1rem;
        transition: all 0.3s ease;
        font-size: 0.95rem;
    }

    /* Fix border radius for select */
    .form-select-theme {
        border-left: 1px solid #e2e8f0;
        border-radius: 12px;
    }

        /* Focus State */
        .form-control-theme:focus, .form-select-theme:focus {
            background-color: #fff;
            border-color: var(--theme-primary);
            box-shadow: var(--theme-shadow-focus);
            border-left: 1px solid var(--theme-primary); /* Hiện lại border trái khi focus */
        }

    /* Input Group Focus Trick: Highlight icon when input focused */
    .input-group:focus-within .input-group-text-theme {
        border-color: var(--theme-primary);
        background-color: rgba(106, 17, 203, 0.05);
    }

    /* --- READONLY INFO BOX --- */
    .info-static-box {
        background: linear-gradient(to right, rgba(106, 17, 203, 0.05), rgba(37, 117, 252, 0.05));
        border-left: 4px solid var(--theme-primary);
        border-radius: 8px;
        padding: 1rem;
    }

    /* --- BUTTONS --- */
    .btn-gradient {
        background: var(--theme-gradient);
        border: 0;
        color: white;
        padding: 0.7rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(106, 17, 203, 0.3);
        transition: all 0.3s;
    }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(106, 17, 203, 0.4);
            color: white;
        }

    .btn-outline-theme {
        background: transparent;
        border: 2px solid #e2e8f0;
        color: #718096;
        padding: 0.7rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.3s;
    }

        .btn-outline-theme:hover {
            border-color: var(--theme-primary);
            color: var(--theme-primary);
            background: white;
        }
</style>

<div class="container py-3 animate-form" style="max-width: 900px;">
    <div class="d-flex align-items-center mb-4">
        <div class="me-3 d-flex align-items-center justify-content-center rounded-circle shadow-sm"
             style="width: 50px; height: 50px; background: white; color: var(--theme-primary);">
            <i class="fa fa-pen-nib fs-5"></i>
        </div>
        <div>
            <h3 class="fw-bold mb-0 text-dark">Cập nhật hợp đồng</h3>
            <p class="text-muted mb-0 small">Chỉnh sửa thông tin chi tiết cho hợp đồng #@Model.Id</p>
        </div>
    </div>

    <form asp-action="Edit" method="post">
        <div class="card card-edit-theme p-4 p-md-5">
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="PhongTroId" />

            <div asp-validation-summary="ModelOnly" class="alert alert-danger border-0 shadow-sm rounded-3 mb-4" role="alert"></div>

            <div class="mb-4">
                <div class="info-static-box d-flex align-items-center">
                    <div class="me-3 text-center" style="min-width: 50px;">
                        <i class="fa fa-home fa-2x" style="color: var(--theme-primary); opacity: 0.7;"></i>
                    </div>
                    <div>
                        <small class="text-uppercase text-muted fw-bold" style="font-size: 0.7rem;">Đang chỉnh sửa cho</small>
                        <div class="fw-bold fs-5 text-dark">
                            @(Model.PhongTro?.NhaTro?.TenNhaTro ?? "Nhà trọ ?")
                            <span class="text-muted mx-2">/</span>
                            <span class="text-primary">@(Model.PhongTro?.TenPhong ?? "Phòng ?")</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-6">
                    <h6 class="text-muted fw-bold small text-uppercase mb-3">Thời gian</h6>

                    <div class="mb-3">
                        <label asp-for="NgayBatDau" class="form-label-theme">Ngày bắt đầu</label>
                        <div class="input-group">
                            <span class="input-group-text input-group-text-theme"><i class="fa fa-calendar-plus"></i></span>
                            <input asp-for="NgayBatDau" type="date" class="form-control form-control-theme" />
                        </div>
                        <span asp-validation-for="NgayBatDau" class="text-danger small mt-1 d-block"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="NgayKetThuc" class="form-label-theme">Ngày kết thúc</label>
                        <div class="input-group">
                            <span class="input-group-text input-group-text-theme"><i class="fa fa-calendar-check"></i></span>
                            <input asp-for="NgayKetThuc" type="date" class="form-control form-control-theme" />
                        </div>
                        <span asp-validation-for="NgayKetThuc" class="text-danger small mt-1 d-block"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <h6 class="text-muted fw-bold small text-uppercase mb-3">Tài chính & Trạng thái</h6>

                    <div class="mb-3">
                        <label asp-for="GiaThue" class="form-label-theme">Giá thuê phòng</label>
                        <div class="input-group">
                            <span class="input-group-text input-group-text-theme fw-bold">₫</span>
                            <input asp-for="GiaThue" class="form-control form-control-theme" placeholder="Nhập giá thuê..." />
                            <span class="input-group-text bg-white border-start-0 text-muted small" style="border-radius: 0 12px 12px 0;">VNĐ</span>
                        </div>
                        <span asp-validation-for="GiaThue" class="text-danger small mt-1 d-block"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="TienCoc" class="form-label-theme">Tiền đặt cọc</label>
                        <div class="input-group">
                            <span class="input-group-text input-group-text-theme fw-bold">₫</span>
                            <input asp-for="TienCoc" class="form-control form-control-theme" placeholder="Nhập tiền cọc..." />
                            <span class="input-group-text bg-white border-start-0 text-muted small" style="border-radius: 0 12px 12px 0;">VNĐ</span>
                        </div>
                        <span asp-validation-for="TienCoc" class="text-danger small mt-1 d-block"></span>
                    </div>
                </div>

                <div class="col-12">
                    <hr class="text-muted opacity-25 my-2">
                </div>

                <div class="col-md-12">
                    <label asp-for="TrangThai" class="form-label-theme">Trạng thái hợp đồng</label>
                    <div class="input-group">
                        <span class="input-group-text input-group-text-theme"><i class="fa fa-info-circle"></i></span>
                        <select asp-for="TrangThai" class="form-select form-select-theme">
                            <option value="1">Đang hiệu lực (Active)</option>
                            <option value="2">Đã thanh lý (Terminated)</option>
                            <option value="3">Đã hủy (Cancelled)</option>
                        </select>
                    </div>
                    <div class="form-text text-muted small mt-2">
                        <i class="fa fa-lightbulb text-warning me-1"></i>
                        Lưu ý: Thay đổi trạng thái có thể ảnh hưởng đến tính khả dụng của phòng.
                    </div>
                    <span asp-validation-for="TrangThai" class="text-danger small mt-1 d-block"></span>
                </div>
            </div>

            <div class="d-flex justify-content-end align-items-center mt-5 pt-3 border-top border-light">
                <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-outline-theme me-3">
                    <i class="fa fa-times me-2"></i> Hủy bỏ
                </a>
                <button type="submit" class="btn btn-gradient px-4">
                    <i class="fa fa-save me-2"></i> Lưu thay đổi
                </button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Script nhỏ để format số tiền tự động (Optional UX improvement)
        // Nếu không cần, bạn có thể bỏ qua script này
        /*
        document.querySelectorAll('input[name="GiaThue"], input[name="TienCoc"]').forEach(input => {
            input.addEventListener('keyup', function(e) {
                // Logic format currency here if needed
            });
        });
        */
    </script>
}