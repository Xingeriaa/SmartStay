@model do_an_tot_nghiep.Models.PhongTro
@{
    ViewData["Title"] = "Chi tiết phòng | " + Model?.TenPhong;
    var dichVuPhong = ViewBag.DichVuPhong as string;
}

<div class="container-fluid px-0">
    <div class="d-flex justify-content-between align-items-end mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a asp-controller="Dashboard" asp-action="Index" class="text-muted text-decoration-none"><i class="fas fa-home me-1"></i>Trang chủ</a></li>
                    <li class="breadcrumb-item"><a asp-action="Index" class="text-muted text-decoration-none">Danh sách phòng</a></li>
                    <li class="breadcrumb-item active">Chi tiết</li>
                </ol>
            </nav>
            <h1 class="fw-bold mb-0" style="font-size:1.75rem;">@Model?.TenPhong</h1>
            <p class="text-muted mb-0 mt-1">Tầng @Model?.Tang · @Model?.DienTich m² · Sức chứa @Model?.SoLuongNguoi người</p>
        </div>
        <div class="d-flex gap-2">
            <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-gradient-primary btn-custom">
                <i class="fas fa-edit me-1"></i> Chỉnh sửa
            </a>
            <a asp-action="Index" asp-route-nhaId="@Model?.NhaTroId" class="btn btn-light border btn-custom">
                <i class="fas fa-arrow-left me-1"></i> Quay lại
            </a>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-xl-4">
            <div class="main-card mb-3 animate-fade-up overflow-hidden">
                @if (!string.IsNullOrEmpty(Model?.AnhPhong))
                {
                    <img src="@Model.AnhPhong" class="w-100" style="max-height:260px;object-fit:cover;"
                         onerror="this.src='https://placehold.co/400x260?text=No+Image'">
                }
                else
                {
                    <div class="d-flex align-items-center justify-content-center bg-light text-muted" style="height:200px;">
                        <div class="text-center"><i class="fas fa-image fa-3x opacity-25"></i><div class="small mt-2">Chưa có ảnh</div></div>
                    </div>
                }
                <div class="p-4">
                    @{
                        string sCls = Model?.Status switch { 1 => "bg-success", 2 => "bg-primary", 3 => "bg-warning text-dark", _ => "bg-secondary" };
                        string sLbl = Model?.Status switch { 1 => "Còn trống", 2 => "Đang thuê", 3 => "Đang bảo trì", _ => Model?.Status.ToString() };
                    }
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="badge @sCls rounded-pill px-3 py-2">@sLbl</span>
                        <span class="fw-bold text-gradient" style="font-size:1.3rem;">@Model?.GiaPhong.ToString("N0") đ</span>
                    </div>
                    <div class="row g-2 text-center">
                        <div class="col-4"><div class="fw-bold">Tầng @Model?.Tang</div><div class="text-muted small">Vị trí</div></div>
                        <div class="col-4"><div class="fw-bold">@Model?.DienTich m²</div><div class="text-muted small">Diện tích</div></div>
                        <div class="col-4"><div class="fw-bold">@Model?.SoLuongNguoi</div><div class="text-muted small">Tối đa</div></div>
                    </div>
                </div>
            </div>

            <!-- IMAGE GALLERY PORTION -->
            @{
                ViewData["EntityType"] = "room";
                ViewData["EntityId"] = Model.Id;
            }
            @await Html.PartialAsync("_ImageGallery")
            <!-- END IMAGE GALLERY -->
        </div>

        <div class="col-xl-8">
            <div class="main-card animate-fade-up" style="animation-delay:.1s">
                <div class="card-header-styled">
                    <h6 class="fw-bold mb-0"><i class="fas fa-info-circle me-2 text-brand"></i>Thông tin chi tiết phòng</h6>
                </div>
                <div class="p-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <table class="table table-borderless table-sm mb-0">
                                <tbody>
                                    <tr><td class="text-muted fw-medium" style="width:130px;">Mã phòng</td><td class="fw-bold">#@Model?.Id</td></tr>
                                    <tr><td class="text-muted fw-medium">Tên phòng</td><td class="fw-bold">@Model?.TenPhong</td></tr>
                                    <tr><td class="text-muted fw-medium">Tầng</td><td><span class="badge bg-light border text-dark">Tầng @Model?.Tang</span></td></tr>
                                    <tr><td class="text-muted fw-medium">Diện tích</td><td>@Model?.DienTich m²</td></tr>
                                    <tr><td class="text-muted fw-medium">Sức chứa</td><td>@Model?.SoLuongNguoi người</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless table-sm mb-0">
                                <tbody>
                                    <tr><td class="text-muted fw-medium" style="width:130px;">Giá thuê</td><td class="fw-bold text-success">@Model?.GiaPhong.ToString("N0") đ</td></tr>
                                    <tr><td class="text-muted fw-medium">Tiền cọc</td><td>@(Model?.TienCoc > 0 ? Model.TienCoc.ToString("N0") + " đ" : "Không cọc")</td></tr>
                                    <tr><td class="text-muted fw-medium">Nội thất</td><td>@(string.IsNullOrEmpty(Model?.NoiThat) ? "—" : Model.NoiThat)</td></tr>
                                    <tr><td class="text-muted fw-medium">Trạng thái</td><td><span class="badge @sCls">@sLbl</span></td></tr>
                                </tbody>
                            </table>
                        </div>
                        @if (!string.IsNullOrEmpty(Model?.DichVu))
                        {
                            <div class="col-12">
                                <hr class="my-1">
                                <div class="fw-medium text-muted small mb-2">Dịch vụ phòng:</div>
                                <div class="d-flex flex-wrap gap-2">
                                    @foreach (var sv in (Model.DichVu.Split(',', StringSplitOptions.RemoveEmptyEntries)))
                                    {
                                        <span class="badge badge-soft-brand"><i class="fas fa-check me-1"></i>@sv.Trim()</span>
                                    }
                                </div>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model?.GhiChu))
                        {
                            <div class="col-12">
                                <hr class="my-1">
                                <div class="fw-medium text-muted small mb-2">Ghi chú:</div>
                                <p class="text-dark small mb-0">@Model.GhiChu</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <div class="main-card mt-3 animate-fade-up p-4" style="animation-delay:.2s">
                <h6 class="fw-bold mb-3"><i class="fas fa-bolt text-brand me-2"></i>Thao tác nhanh</h6>
                <div class="d-flex flex-wrap gap-2">
                    @if (Model?.Status == 1)
                    {
                        <a asp-controller="HopDong" asp-action="Create" asp-route-roomId="@Model.Id" class="btn btn-gradient-primary btn-custom">
                            <i class="fas fa-file-signature me-1"></i> Tạo hợp đồng thuê
                        </a>
                    }
                    <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-light border btn-custom">
                        <i class="fas fa-edit me-1"></i> Chỉnh sửa phòng
                    </a>
                    <a asp-action="Index" asp-route-nhaId="@Model?.NhaTroId" class="btn btn-light border btn-custom">
                        <i class="fas fa-building me-1"></i> Xem tất cả phòng tòa nhà
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>