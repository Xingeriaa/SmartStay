<div class="card border-0 shadow-sm rounded-4 animate-fade-up mt-4" style="animation-delay:.2s">
    <div class="card-header bg-white border-bottom p-4">
        <h6 class="fw-bold mb-0 text-dark">
            <i class="fas fa-images me-2 text-primary opacity-75"></i>Hình ảnh tham khảo
        </h6>
    </div>
    <div class="card-body p-4">
        <div id="imageViewerGallery" class="row g-2">
            <!-- Images rendered via JS -->
            <div class="col-12 text-center py-4" id="imageViewerLoader">
                <i class="fas fa-spinner fa-spin text-primary"></i> Đang tải hình ảnh...
            </div>
        </div>
    </div>
</div>

<!-- Modal for fullscreen viewing -->
<div class="modal fade" id="imageFullscreenModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-transparent border-0">
            <div class="modal-header border-0 pb-0 justify-content-end">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center p-0">
                <img id="fullscreenImageSrc" src="" class="img-fluid rounded shadow-lg" style="max-height: 85vh; object-fit: contain;">
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const entityType = '@ViewData["EntityType"]'; // building or room
    const entityId = @ViewData["EntityId"];
    
    fetch(`/api/images/${entityType}/${entityId}`)
        .then(res => res.json())
        .then(images => {
            const gallery = document.getElementById('imageViewerGallery');
            document.getElementById('imageViewerLoader').remove();
            
            if (!images || images.length === 0) {
                gallery.innerHTML = '<div class="col-12 text-center text-muted small py-3">Không có hình ảnh nào.</div>';
                return;
            }
            
            images.forEach(img => {
                const colSize = img.isThumbnail ? 'col-12 mb-2' : 'col-6 col-md-4';
                const aspect = img.isThumbnail ? '16/9' : '1/1';
                
                gallery.innerHTML += `
                    <div class="${colSize}">
                        <div class="rounded overflow-hidden shadow-sm" style="cursor: pointer; aspect-ratio: ${aspect}; background: #f8f9fa;" onclick="openFullscreen('${img.imageUrl}')">
                            <img src="${img.imageUrl}" style="width:100%; height:100%; object-fit:cover;" class="hover-zoom" alt="Ảnh">
                        </div>
                    </div>
                `;
            });
        })
        .catch(err => console.error(err));
});

function openFullscreen(url) {
    document.getElementById('fullscreenImageSrc').src = url;
    var myModal = new bootstrap.Modal(document.getElementById('imageFullscreenModal'));
    myModal.show();
}
</script>
<style>
.hover-zoom {
    transition: transform 0.3s ease;
}
.hover-zoom:hover {
    transform: scale(1.05);
}
</style>
