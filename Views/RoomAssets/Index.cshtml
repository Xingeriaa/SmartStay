@model List<do_an_tot_nghiep.Models.RoomAsset>
@{
    ViewData["Title"] = "Thi·∫øt b·ªã ph√≤ng";
    var roomId = ViewBag.RoomId;
    var total = Model?.Count ?? 0;
    var broken = Model?.Count(x => x.Status == 2 || x.Status == 3) ?? 0;
    var active = Model?.Count(x => x.Status == 1) ?? 0;
}

<div class="container-fluid px-0">
    @* --- HEADER --- *@
    <div class="d-flex justify-content-between align-items-end mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a asp-controller="Dashboard" asp-action="Index" class="text-muted text-decoration-none"><i class="fas fa-home me-1"></i>Trang ch·ªß</a></li>
                    <li class="breadcrumb-item"><a asp-controller="Phong" asp-action="Index" class="text-muted text-decoration-none">Ph√≤ng tr·ªç</a></li>
                    <li class="breadcrumb-item active">Thi·∫øt b·ªã</li>
                </ol>
            </nav>
            <h1 class="fw-bold mb-0" style="font-size:1.75rem;">Thi·∫øt b·ªã & T√†i s·∫£n</h1>
            <p class="text-muted mb-0 mt-1">Qu·∫£n l√Ω c∆° s·ªü v·∫≠t ch·∫•t n·ªôi th·∫•t ph√≤ng #@roomId</p>
        </div>
        <div class="d-flex gap-2">
            <a asp-action="Create" asp-route-roomId="@roomId" class="btn btn-gradient-primary btn-custom shadow">
                <i class="fas fa-plus me-1"></i> Th√™m thi·∫øt b·ªã
            </a>
        </div>
    </div>

    @* --- ALERTS --- *@
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible border-0 shadow-sm rounded-3 mb-3 fade show">
            <i class="fas fa-check-circle me-2"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @* --- STAT CARDS --- *@
    <div class="row g-3 mb-4">
        <div class="col-xl-4 col-md-6">
            <div class="stat-card animate-fade-up">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="stat-label">T·ªîNG THI·∫æT B·ªä</div>
                        <div class="stat-value text-gradient mt-1">@total</div>
                    </div>
                    <div class="stat-icon-wrapper bg-icon-theme"><i class="fas fa-couch"></i></div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6">
            <div class="stat-card animate-fade-up" style="animation-delay:.1s">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="stat-label">ƒêANG S·ª¨ D·ª§NG</div>
                        <div class="stat-value text-success mt-1">@active</div>
                    </div>
                    <div class="stat-icon-wrapper bg-icon-info text-success"><i class="fas fa-check-double"></i></div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6">
            <div class="stat-card animate-fade-up" style="animation-delay:.2s">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="stat-label">C·∫¶N B·∫¢O TR√å/H·ªéNG</div>
                        <div class="stat-value text-danger mt-1">@broken</div>
                    </div>
                    <div class="stat-icon-wrapper bg-icon-warning text-danger"><i class="fas fa-tools"></i></div>
                </div>
            </div>
        </div>
    </div>

    @* --- FILTERS --- *@
    <div class="main-card mb-3 p-4 animate-fade-up" style="animation-delay:.1s">
        <div class="row g-3 align-items-end">
            <div class="col-xl-6 col-md-8">
                <label class="fw-semibold small text-muted mb-1 d-block"><i class="fas fa-search me-1"></i>T√¨m nhanh</label>
                <div class="search-group">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="T√™n thi·∫øt b·ªã, s·ªë hi·ªáu (S/N)..." oninput="applyFilters()">
                </div>
            </div>
            <div class="col-xl-4 col-md-4">
                <label class="fw-semibold small text-muted mb-1 d-block"><i class="fas fa-filter me-1"></i>Tr·∫°ng th√°i</label>
                <select class="form-select" id="filterStatus" onchange="applyFilters()">
                    <option value="">-- T·∫•t c·∫£ tr·∫°ng th√°i --</option>
                    <option value="ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông t·ªët</option>
                    <option value="h∆∞ h·ªèng">ƒêang h∆∞ h·ªèng</option>
                    <option value="h·ªèng">ƒê√£ h·ªèng (B·ªè)</option>
                    <option value="thanh l√Ω">ƒê√£ thanh l√Ω</option>
                </select>
            </div>
            <div class="col-xl-2 col-md-12">
                <button class="btn btn-light border w-100" onclick="resetFilters()"><i class="fas fa-times me-1"></i>X√≥a l·ªçc</button>
            </div>
        </div>
        <div id="filterTags" class="mt-3 d-flex flex-wrap gap-2"></div>
    </div>

    @* --- DATA TABLE --- *@
    <div class="main-card animate-fade-up" style="animation-delay:.2s">
        <div class="card-header-styled">
            <div class="d-flex align-items-center gap-2">
                <i class="fas fa-boxes text-brand"></i>
                <h5 class="fw-bold mb-0">Danh s√°ch t√†i s·∫£n n·ªôi th·∫•t</h5>
                <span class="badge bg-soft-brand text-brand">Ph√≤ng @roomId</span>
            </div>
            <button class="btn btn-light border btn-sm" onclick="location.reload()"><i class="fas fa-sync-alt text-muted"></i></button>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center" id="dataTable">
                <thead class="table-light">
                    <tr>
                        <th class="text-start" style="cursor:pointer" onclick="sortTable(0)">T√™n thi·∫øt b·ªã <i class="fas fa-sort ms-1 small text-muted"></i></th>
                        <th>S/N</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th class="text-end" style="width:180px;">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            string statusText = item.Status switch { 1 => "Ho·∫°t ƒë·ªông", 2 => "H∆∞ h·ªèng", 3 => "H·ªèng", 4 => "Thanh l√Ω", _ => "Kh√°c" };
                            string statusBadge = item.Status switch
                            {
                                1 => "bg-soft-success text-success",
                                2 => "bg-soft-warning text-warning",
                                3 => "bg-soft-danger text-danger",
                                _ => "bg-soft-secondary text-secondary"
                            };

                            <tr data-status="@statusText.ToLower()" data-name="@item.AssetName.ToLower()">
                                <td class="text-start">
                                    <div class="fw-bold">@item.AssetName</div>
                                    <small class="text-muted">ID: #@item.Id</small>
                                </td>
                                <td><code class="small">@(string.IsNullOrEmpty(item.SerialNumber) ? "N/A" : item.SerialNumber)</code></td>
                                <td><span class="fw-bold">@item.Quantity</span></td>
                                <td>
                                    <span class="badge @statusBadge rounded-pill px-3">
                                        <i class="fas fa-circle me-1" style="font-size:0.5rem"></i> @statusText
                                    </span>
                                </td>
                                <td class="text-end">
                                    <div class="btn-group shadow-sm" style="border-radius: 8px; overflow: hidden;">
                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-light border-end" title="Ch·ªânh s·ª≠a">
                                            <i class="fas fa-edit text-primary"></i>
                                        </a>
                                        <form asp-action="Delete" asp-route-id="@item.Id" asp-route-roomId="@item.RoomId" method="post" class="d-inline"
                                              onsubmit="return confirm('X√°c nh·∫≠n g·ª° b·ªè thi·∫øt b·ªã n√†y kh·ªèi ph√≤ng?')">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm btn-light" title="X√≥a">
                                                <i class="fas fa-trash-alt text-danger"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5" class="text-center py-5">
                                <i class="fas fa-couch fa-3x text-muted opacity-25 d-block mb-3"></i>
                                <h6 class="text-muted">Ph√≤ng n√†y ch∆∞a ƒë∆∞·ª£c trang b·ªã thi·∫øt b·ªã</h6>
                                <a asp-action="Create" asp-route-roomId="@roomId" class="btn btn-sm btn-gradient-primary mt-2">Th√™m ngay</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="px-4 py-3 border-top bg-light rounded-bottom">
            <span class="text-muted small">Quy t·∫Øc: Thi·∫øt b·ªã h·ªèng (M·ª©c 3) c·∫ßn ƒë∆∞·ª£c c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë·ªÉ Ban qu·∫£n l√Ω l√™n k·∫ø ho·∫°ch thay m·ªõi.</span>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const allRows = Array.from(document.querySelectorAll('#dataTable tbody tr[data-status]'));

        function applyFilters() {
            const q = document.getElementById('searchInput').value.toLowerCase().trim();
            const status = document.getElementById('filterStatus').value.toLowerCase();

            allRows.forEach(row => {
                const matchQ = !q || row.dataset.name?.includes(q) || row.innerText.toLowerCase().includes(q);
                const matchS = !status || row.dataset.status === status;
                row.style.display = (matchQ && matchS) ? '' : 'none';
            });
            renderTags(q, status);
        }

        function renderTags(q, status) {
            const c = document.getElementById('filterTags'); c.innerHTML = '';
            const tag = (l, cl) => c.innerHTML += `<span class="badge bg-soft-brand text-brand border px-3 py-2 rounded-pill" style="font-size:.8rem">${l} <span style="cursor:pointer;margin-left:6px" onclick="${cl}">‚úï</span></span>`;
            if (q) tag(`üîç "${q}"`, `document.getElementById('searchInput').value='';applyFilters()`);
            if (status) tag(`üìå ${status}`, `document.getElementById('filterStatus').value='';applyFilters()`);
        }

        function resetFilters() {
            ['searchInput', 'filterStatus'].forEach(id => document.getElementById(id).value = '');
            applyFilters();
        }

        function sortTable(col) {
            const tbody = document.querySelector('#dataTable tbody');
            const rows = Array.from(tbody.querySelectorAll('tr[data-status]'));
            const asc = !this.asc; this.asc = asc;
            rows.sort((a, b) => {
                const av = a.cells[col].innerText;
                const bv = b.cells[col].innerText;
                return asc ? av.localeCompare(bv) : bv.localeCompare(av);
            });
            rows.forEach(r => tbody.appendChild(r));
        }
    </script>
}